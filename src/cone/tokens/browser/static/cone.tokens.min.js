var cone_tokens=function(e,t,s){"use strict";class i{static initialize(e){t(".token",e).each((function(){new i(t(this))}))}constructor(e){this.elem=e,this.settings=e.data("token-settings");const s=this;t(".btn-group.timeranges button",e).each((function(){const e=t(this);e.on("click",(function(t){s.set_timerange(e.data("timerange-scope"))}))})),t(".btn-group.usage-count button",e).each((function(){const e=t(this);e.on("click",(function(t){s.set_usage_count(e.data("usage-count"))}))}))}request_api(e){const t=this.settings;s.ajax.request({url:`${t.base_url}/update_token`,params:e,type:"json",method:"POST",success:(e,i,n)=>{e.success?s.ajax.action({name:"content",selector:"#content",mode:"inner",url:`${t.base_url}`,params:{}}):s.show_error(e.message)},error:(e,t,i)=>{s.show_error(`Failed to request JSON API: ${i}`)}})}set_timerange(e){const t=this.settings.timeranges;let s,i;if("morning"==e){const e=t.morning;s=new Date,s.setHours(e.from.hour,e.from.minute,0),i=new Date,i.setHours(e.to.hour,e.to.minute,0)}else if("afternoon"==e){const e=t.afternoon;s=new Date,s.setHours(e.from.hour,e.from.minute,0),i=new Date,i.setHours(e.to.hour,e.to.minute,0)}else if("today"==e){const e=t.today;s=new Date,s.setHours(e.from.hour,e.from.minute,0),i=new Date,i.setHours(e.to.hour,e.to.minute,0)}function n(e){return e&&(e=new Date(e.getTime()-6e4*e.getTimezoneOffset())),e?e.toISOString():""}this.request_api({valid_from:n(s),valid_to:n(i)})}set_usage_count(e){this.request_api({usage_count:e||"-1"})}}class n{static initialize(e){t(".tokens-overview-container",e).each((function(){new n(t(this))}))}constructor(e){this.container=e,this.tokens_elem=t("#tokens-overview",e),this.tokens=t("object.token_qr",this.tokens_elem),this.tokens_title=t("#tokens-overview-title",e),this.set_token_size=this.set_token_size.bind(this),this.size_input=t("<input />").addClass("token-button").on("change",this.set_token_size),this.size_input_label=t("<label />").addClass("input-label").text("Token Size"),this.size_container=t("<div />").addClass("token-size").append(this.size_input_label).append(this.size_input).append(t("<span>%</span>")).appendTo(this.tokens_title),this.tokens.length?this.original_size=parseInt(t(this.tokens[0]).attr("width")):this.original_size=256,this.token_size=100}get token_size(){return this._token_size}set token_size(e){e||(e=100);let s=this.original_size*(e/100);this.tokens_elem.css("grid-template-columns",`repeat( auto-fit, minmax(${s}px, 1fr) )`),this.tokens.each((function(){let e=t(this);e.attr("width",`${s}px`),e.attr("height",`${s}px`)})),this.size_input.val()||this.size_input.val(e),this._token_size=e}set_token_size(e){e.preventDefault();let t=this.size_input.val();this.token_size=t}}class o{static initialize(e){t(".tokens-container",e).each((function(){new o(t(this))}))}constructor(e){this.elem=e,this.token_uid_elem=t("[name=token-uid]",e),this.scan_token_elem=t(".scan-token",e),this.scan_token=this.scan_token.bind(this),this.scan_token_elem.on("click",(e=>{this.scan_token()}))}scan_token(){uid_elem=this.token_uid_elem,uid_elem.val(""),uid_elem[0].focus(),uid_elem.on("change",(()=>{console.log("change"),36==uid_elem.val().length&&(uid_elem.val(""),uid_elem.off("change"))}))}}return t((function(){s.ajax.register(i.initialize,!0),s.ajax.register(o.initialize,!0),s.ajax.register(n.initialize,!0)})),e.Tokens=o,e.TokensOverview=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({},jQuery,ts);
