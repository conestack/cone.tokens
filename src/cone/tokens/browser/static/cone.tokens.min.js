var cone_tokens=function(t,e,s){"use strict";class i{static initialize(t){e(".token",t).each((function(){new i(e(this))}))}constructor(t){this.elem=t,this.settings=t.data("token-settings");const s=this;e(".btn-group.timeranges button",t).each((function(){const t=e(this);t.on("click",(function(e){s.set_timerange(t.data("timerange-scope"))}))})),e(".btn-group.usage-count button",t).each((function(){const t=e(this);t.on("click",(function(e){s.set_usage_count(t.data("usage-count"))}))}))}request_api(t){const e=this.settings;s.ajax.request({url:`${e.base_url}/update_token`,params:t,type:"json",method:"POST",success:(t,i,n)=>{t.success?s.ajax.action({name:"content",selector:"#content",mode:"inner",url:`${e.base_url}`,params:{}}):s.show_error(t.message)},error:(t,e,i)=>{s.show_error(`Failed to request JSON API: ${i}`)}})}set_timerange(t){const e=this.settings.timeranges;let s,i;if("morning"==t){const t=e.morning;s=new Date,s.setHours(t.from.hour,t.from.minute,0),i=new Date,i.setHours(t.to.hour,t.to.minute,0)}else if("afternoon"==t){const t=e.afternoon;s=new Date,s.setHours(t.from.hour,t.from.minute,0),i=new Date,i.setHours(t.to.hour,t.to.minute,0)}else if("today"==t){const t=e.today;s=new Date,s.setHours(t.from.hour,t.from.minute,0),i=new Date,i.setHours(t.to.hour,t.to.minute,0)}function n(t){return t&&(t=new Date(t.getTime()-6e4*t.getTimezoneOffset())),t?t.toISOString():""}this.request_api({valid_from:n(s),valid_to:n(i)})}set_usage_count(t){this.request_api({usage_count:t})}}class n{static initialize(t){e(".tokens-overview-container",t).each((function(){new n(e(this))}))}constructor(t){this.container=t,this.tokens_elem=e("#tokens-overview",t),this.tokens=e("object.token_qr",this.tokens_elem),this.tokens_title=e("#tokens-overview-title",t),this.set_token_size=this.set_token_size.bind(this),this.size_input=e('<input type="number" />').addClass("token-button").on("change",this.set_token_size),this.size_input_label=e("<label />").addClass("input-label").text("Token Size"),this.size_container=e("<div />").addClass("token-size").append(this.size_input_label).append(this.size_input).append(e("<span>%</span>")).appendTo(this.tokens_title),this.tokens.length?this.original_size=parseInt(e(this.tokens[0]).attr("width")):this.original_size=256,this.token_size=100}get token_size(){return this._token_size}set token_size(t){t||(t=100);let s=this.original_size*(t/100);this.tokens_elem.css("grid-template-columns",`repeat( auto-fit, minmax(${s}px, 1fr) )`),this.tokens.each((function(){let t=e(this);t.attr("width",`${s}px`),t.attr("height",`${s}px`)})),this.size_input.val()||this.size_input.val(t),this._token_size=t}set_token_size(t){t.preventDefault();let e=this.size_input.val();this.token_size=e}}class o{static initialize(t){e(".tokens-container",t).each((function(){new o(e(this))}))}constructor(t){this.elem=t,this.base_url=t.data("base-url"),this.button=e(".scan-token",t),this._input_wrapper=null,this._input=null,this.scan_token=this.scan_token.bind(this),this.button.on("click",(t=>{this.scan_token()}))}get active(){return null!==this._input}set active(t){if(t==this.value)return;let s=this.button;if(t){let t=this._input_wrapper=e("<div/>").css("width",0).css("overflow","hidden"),i=this._input=e('<input type="text">');t.append(i),this.elem.append(t),s.removeClass("inactive").addClass("active"),i[0].focus()}else this._input_wrapper.remove(),this._input_wrapper=null,this._input=null,s.removeClass("active").addClass("inactive")}scan_token(){this.active=!0;let t=this._input;t.one("change",(()=>{this.query_token(t.val())}))}query_token(t){s.ajax.request({url:`${this.base_url}/query_token`,params:{value:t},type:"json",success:(t,e,i)=>{t.success?t.token?s.ajax.action({name:"layout",selector:"#layout",mode:"replace",url:`${this.base_url}/${t.token.uid}`,params:{}}):(this.active=!1,s.show_error("Token not exists")):s.show_error(t.message)},error:(t,e,i)=>{s.show_error(`Failed to request JSON API: ${i}`)}})}}return e((function(){s.ajax.register(i.initialize,!0),s.ajax.register(o.initialize,!0),s.ajax.register(n.initialize,!0)})),t.TokenScanner=o,t.TokensOverview=n,Object.defineProperty(t,"__esModule",{value:!0}),t}({},jQuery,ts);
